# ?? LanguageExt C# - Visual Guide

## Functional Programming Flow with LanguageExt

```
???????????????????????????????????????????????????????????????????????
?                                                                       ?
?                     FUNCTIONAL CORE (Pure)                            ?
?                                                                       ?
?  ????????????????      ????????????????      ????????????????       ?
?  ?   Domain     ?      ?    Value     ?      ?   Business   ?       ?
?  ?   Models     ????????   Objects    ????????    Logic     ?       ?
?  ? (Immutable)  ?      ? (Validation) ?      ?    (Pure)    ?       ?
?  ????????????????      ????????????????      ????????????????       ?
?         ?                      ?                      ?              ?
?         ?                      ?                      ?              ?
?         ?                      ?                      ?              ?
?  ??????????????????????????????????????????????????????????         ?
?  ?          Fin<T> - Railway-Oriented Programming         ?         ?
?  ?                                                          ?         ?
?  ?   Success Path ??????????????????? Fin<Order>          ?         ?
?  ?                                                          ?         ?
?  ?   Failure Path ??????????????????? Error                ?         ?
?  ??????????????????????????????????????????????????????????         ?
?                                                                       ?
?????????????????????????????????????????????????????????????????????
                            ?
                            ?  LINQ Query Expressions
                            ?
                            ?
???????????????????????????????????????????????????????????????????????
?                                                                       ?
?                  IMPERATIVE SHELL (Side Effects)                      ?
?                                                                       ?
?  ????????????????      ????????????????      ????????????????       ?
?  ?   Database   ?      ?     HTTP     ?      ?    Events    ?       ?
?  ?      IO      ?      ?    Calls     ?      ?  Publishing  ?       ?
?  ?  IO Monad    ?      ?  Try Monad   ?      ?  IO Monad    ?       ?
?  ????????????????      ????????????????      ????????????????       ?
?                                                                       ?
???????????????????????????????????????????????????????????????????????
```

## The Fin<T> Monad - Railway-Oriented Programming

```
Input Request
     ?
     ?
???????????????????????????????????????????????????????????????????
?                        HAPPY PATH                                ?
?                                                                   ?
?  ValidateRequest ????? GetCart ????? CreateOrder ????? Success  ?
?         ?                 ?               ?                      ?
?         ?                 ?               ?                      ?
?         ?                 ?               ?                      ?
?  ValidationError   NotFoundError   InvalidOperationError         ?
?         ?                 ?               ?                      ?
?         ???????????????????????????????????                      ?
?                           ?                                      ?
?                           ?                                      ?
?                    ERROR PATH                                    ?
?              (Short-circuits on first error)                     ?
???????????????????????????????????????????????????????????????????
```

## LINQ Query Expression Pattern

```csharp
// This is how LINQ expressions work with Fin<T>

var result =
    from step1 in Operation1()     // Fin<A>
    from step2 in Operation2(step1) // Fin<B>
    from step3 in Operation3(step2) // Fin<C>
    select step3;                   // Fin<C>

// Visualized:

Operation1() ??? Success ??? Operation2() ??? Success ??? Operation3() ??? Success
     ?                            ?                             ?
     ?                            ?                             ?
   Error ??????????????????????? Error ????????????????????? Error
     ?                            ?                             ?
     ????????????????????????????????????????????????????????????
                                  ?
                                  ?
                          Final Error Result
```

## Monad Hierarchy

```
                          ???????????????
                          ?   Monad     ?
                          ?  (Abstract) ?
                          ???????????????
                                 ?
                 ?????????????????????????????????
                 ?               ?               ?
          ??????????????? ????????????? ???????????????
          ?   Fin<T>    ? ? Option<T> ? ?    IO<T>    ?
          ?  (Either)   ? ?  (Maybe)  ? ? (Side Eff.) ?
          ??????????????? ????????????? ???????????????
                 ?               ?               ?
          ??????????????? ????????????? ???????????????
          ?   Success   ? ?   Some    ? ?  Deferred   ?
          ?     or      ? ?     or    ? ?  Execution  ?
          ?    Error    ? ?   None    ? ?             ?
          ??????????????? ????????????? ???????????????
```

## Value Object Pattern

```
???????????????????????????????????????????????????????????????????
?                      Primitive Type                              ?
?                                                                   ?
?  string email = "invalid-email"  ?????? ? No validation         ?
?  decimal amount = -100           ?????? ? Invalid state         ?
?  Guid userId = Guid.Empty        ?????? ? Can be empty          ?
???????????????????????????????????????????????????????????????????
                            ?
                            ? Wrap in Value Object
???????????????????????????????????????????????????????????????????
?                      Value Object                                ?
?                                                                   ?
?  Fin<Email> email = Email.From("test@test.com")                 ?
?                           ?                                       ?
?                           ??? ? Validated format                 ?
?                           ??? ? Type-safe                        ?
?                                                                   ?
?  Fin<Money> amount = Money.FromDecimal(100)                      ?
?                           ?                                       ?
?                           ??? ? Non-negative                     ?
?                           ??? ? Business operations              ?
?                                                                   ?
?  UserId userId = UserId.New                                      ?
?                           ?                                       ?
?                           ??? ? Never empty                      ?
?                           ??? ? Type identity                    ?
???????????????????????????????????????????????????????????????????
```

## Order Creation Flow - Functional Style

```
???????????????????????????????????????????????????????????????????????????
?                        CreateOrderCommand                                ?
?                    { CartId, UserId, Address }                           ?
???????????????????????????????????????????????????????????????????????????
                             ?
                             ?
                    ????????????????????
                    ?  Validate Input  ? ??? Fin<ValidCommand>
                    ????????????????????
                             ? (from validCmd in ...)
                             ?
                    ????????????????????
                    ?    Get Cart      ? ??? Fin<Cart>
                    ????????????????????
                             ? (from cart in ...)
                             ?
                    ????????????????????
                    ?  Validate Cart   ? ??? Fin<Unit>
                    ?  - Has items?    ?
                    ?  - Not checked?  ?
                    ????????????????????
                             ? (from _ in ...)
                             ?
                    ????????????????????
                    ?  Create Order    ? ??? Fin<Order>
                    ?  Items           ?
                    ????????????????????
                             ? (from items in ...)
                             ?
                    ????????????????????
                    ?  Create Order    ? ??? Fin<Order>
                    ?  Aggregate       ?
                    ????????????????????
                             ? (from order in ...)
                             ?
                    ????????????????????
                    ?   Save Order     ? ??? Fin<Order>
                    ?   (IO Monad)     ?
                    ????????????????????
                             ? (from saved in ...)
                             ?
                    ????????????????????
                    ? Mark Cart as     ? ??? Fin<Unit>
                    ?  CheckedOut      ?
                    ????????????????????
                             ? (from __ in ...)
                             ?
                    ????????????????????
                    ? Publish Event    ? ??? Fin<Unit>
                    ?  (IO Monad)      ?
                    ????????????????????
                             ? (select order)
                             ?
                    ????????????????????
                    ?   OrderResult    ?
                    ?   (Success!)     ?
                    ????????????????????
```

## Error Handling Comparison

### Traditional Exception-Based

```
???????????????
?  Operation  ?
???????????????
       ?
       ???? Success ??? Continue
       ?
       ???? Exception ??? ?? Unwind Stack
                          ?
                          ???? Caught? ??? Handle
                          ?
                          ???? Not Caught? ??? ?? Crash
```

### Functional with Fin<T>

```
???????????????
?  Operation  ? ??? Fin<Result>
???????????????
       ?
       ???? Success ??? Continue with value
       ?
       ???? Error ??? Short-circuit to error handler
                     ?
                     ???? Pattern match ??? Handle gracefully
```

## Db Monad Pattern

```
????????????????????????????????????????????????????????????????????
?                    Database Operations                            ?
?                                                                    ?
?  from entity in GetEntity<DbContext, Entity>(predicate)           ?
?                    ?                                               ?
?                    ???? Query database                             ?
?                    ???? Apply includes                             ?
?                    ???? Return Fin<Entity>                         ?
?                                                                    ?
?  from updated in UpdateEntity<DbContext, Entity>(entity, update)  ?
?                    ?                                               ?
?                    ???? Apply update function                      ?
?                    ???? Track changes                              ?
?                    ???? Return Fin<Entity>                         ?
?                                                                    ?
?  select updated                                                    ?
?                                                                    ?
????????????????????????????????????????????????????????????????????
                        ?
                        ?
              RunSaveAsync(dbContext, env)
                        ?
                        ???? Execute in transaction
                        ???? SaveChanges
                        ???? Dispatch domain events
                        ???? Return Fin<Entity>
```

## Event-Driven Flow with Functional Handlers

```
????????????????????????????????????????????????????????????????????????
?                         Domain Event                                  ?
?                    OrderCreatedDomainEvent                            ?
????????????????????????????????????????????????????????????????????????
                             ?
                             ?
                    ????????????????????
                    ?   Interceptor    ?
                    ? (Before Save)    ?
                    ????????????????????
                             ?
                             ?
                    ????????????????????
                    ?  Domain Event    ? ??? Process in same transaction
                    ?    Handler       ?
                    ????????????????????
                             ?
                             ?
                    ????????????????????
                    ?  Publish         ?
                    ? Integration Event?
                    ????????????????????
                             ?
                             ?
              ???????????????????????????????
              ?                              ?
              ?                              ?
    ????????????????????          ????????????????????
    ?  Payment Module  ?          ? Inventory Module ?
    ?    Consumer      ?          ?    Consumer      ?
    ????????????????????          ????????????????????
              ?                              ?
              ?                              ?
              ?                              ?
    Process Payment              Update Stock Levels
```

## Type Safety Visualization

```
???????????????????????????????????????????????????????????????????
?                    Without Strong Types                          ?
?                                                                   ?
?  public void Transfer(Guid from, Guid to, decimal amount)       ?
?                        ?        ?           ?                    ?
?                        ?        ?           ?                    ?
?                  ???????????????????????????????????            ?
?                  ?  Can easily mix up parameters!  ?            ?
?                  ?  No validation on amount        ?            ?
?                  ???????????????????????????????????            ?
???????????????????????????????????????????????????????????????????
                             ?
                             ? Refactor with Value Objects
???????????????????????????????????????????????????????????????????
?                     With Strong Types                            ?
?                                                                   ?
?  public Fin<Unit> Transfer(                                      ?
?      AccountId from,     ?????? ? Type-safe (can't mix)         ?
?      AccountId to,       ?????? ? Type-safe (can't mix)         ?
?      Money amount        ?????? ? Validated (positive)          ?
?  )                                                                ?
?                                                                   ?
?  Compiler prevents:                                               ?
?  ??? Transfer(to, from, amount)     ? Wrong order               ?
?  ??? Transfer(productId, ...)       ? Wrong type                ?
?  ??? Transfer(..., -100)            ? Invalid amount            ?
???????????????????????????????????????????????????????????????????
```

## Composition Over Configuration

```
Small, Pure Functions
        ?
        ??? ValidateEmail(string) ??? Fin<Email>
        ?
        ??? ValidatePassword(string) ??? Fin<Password>
        ?
        ??? ValidateAge(int) ??? Fin<Age>
        
        ? Compose with LINQ
        ?

Complex Operation
        ?
        ??? CreateUser(string email, string pwd, int age)
            ?
            ??? from e in ValidateEmail(email)
                from p in ValidatePassword(pwd)
                from a in ValidateAge(age)
                from user in User.Create(e, p, a)
                from saved in SaveUser(user)
                select saved
```

## Benefits Summary

```
????????????????????????????????????????????????????????????????????
?                    Traditional Approach                           ?
?                                                                    ?
?  ? Null reference exceptions                                     ?
?  ? Hidden exceptions                                             ?
?  ? Mutable state bugs                                            ?
?  ? Mixed business & infrastructure logic                         ?
?  ? Hard to test                                                  ?
?  ? Difficult to reason about                                     ?
????????????????????????????????????????????????????????????????????
                            ?
                            ? Functional Programming
????????????????????????????????????????????????????????????????????
?                   Functional Approach                             ?
?                                                                    ?
?  ? No nulls (Option<T>)                                          ?
?  ? Explicit errors (Fin<T>)                                      ?
?  ? Immutable data (records)                                      ?
?  ? Separated concerns (IO monad)                                 ?
?  ? Easy to test (pure functions)                                 ?
?  ? Easy to reason about (declarative)                            ?
?  ? Type-safe (value objects)                                     ?
?  ? Composable (LINQ expressions)                                 ?
????????????????????????????????????????????????????????????????????
```

---

## Key Takeaways

1. **Functional Core, Imperative Shell** - Keep business logic pure, side effects at boundaries
2. **Railway-Oriented Programming** - Use `Fin<T>` for explicit error handling
3. **Type Safety** - Wrap primitives in value objects
4. **Immutability** - Use records and with expressions
5. **Composition** - Build complex operations from simple functions
6. **LINQ Expressions** - For readable, declarative code

---

**"Make invalid states unrepresentable"** - Yaron Minsky
